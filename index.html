<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#f8fafc">
<title>GeoLab v2.3 (Fix)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
    :root { 
        --bg-color: #f8fafc; 
        --surface: rgba(255, 255, 255, 0.95);
        --primary: #2563eb; 
        --text-main: #0f172a;
        --glass-border: 1px solid rgba(255,255,255,0.8);
    }
    
    body {
        margin: 0; display: flex; flex-direction: column; align-items: center;
        font-family: 'Inter', system-ui, -apple-system, sans-serif; 
        background-color: var(--bg-color);
        height: 100vh; width: 100vw; overflow: hidden;
        touch-action: none; user-select: none; -webkit-user-select: none;
        color: var(--text-main);
    }
    
    /* LOADING SCREEN */
    #loading-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #ffffff; z-index: 9999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: opacity 0.4s ease;
    }
    .spinner {
        width: 40px; height: 40px; border-radius: 50%;
        background: conic-gradient(#0000 10%, var(--primary));
        -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 6px), #000 0);
        animation: spin 0.8s infinite linear; margin-bottom: 15px;
    }
    .loading-brand { font-weight: 800; font-size: 1.1rem; letter-spacing: -0.5px; }
    @keyframes spin { to { transform: rotate(1turn); } }

    /* HEADER */
    header { 
        position: absolute; top: 20px; width: 90%; max-width: 600px;
        display: flex; justify-content: space-between; align-items: center;
        padding: 10px 16px; box-sizing: border-box;
        background: var(--surface); backdrop-filter: blur(16px);
        border-radius: 24px; border: var(--glass-border);
        box-shadow: 0 10px 30px -5px rgba(0,0,0,0.06); z-index: 100;
    }
    .brand-title { font-weight: 800; font-size: 1.1rem; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; }
    
    .dev-badge {
        background: linear-gradient(135deg, #f59e0b, #d97706); 
        color: white; font-size: 0.6rem; font-weight: 700;
        padding: 3px 8px; border-radius: 6px; 
        text-transform: uppercase; letter-spacing: 1px;
    }
    
    .brand-status { font-size: 0.75rem; color: #64748b; font-weight: 600; display: flex; align-items: center; gap: 6px; margin-top: 2px;}
    .dot { width: 6px; height: 6px; background: #22c55e; border-radius: 50%; }

    .header-actions { display: flex; gap: 8px; }
    .btn-icon-only {
        width: 40px; height: 40px; border-radius: 14px;
        background: rgba(0,0,0,0.04); border: none; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2rem; transition: all 0.2s; color: var(--text-main);
    }
    .btn-icon-only:active { transform: scale(0.92); background: rgba(0,0,0,0.08); }

    /* DEBUG CONSOLE */
    #debug-console {
        position: fixed; top: 80px; right: 20px; width: 240px;
        background: rgba(0, 0, 0, 0.92); backdrop-filter: blur(12px);
        color: #00ff00; font-family: 'Courier New', monospace; font-size: 11px;
        padding: 15px; border-radius: 12px; z-index: 400;
        display: none; pointer-events: none;
        white-space: pre-wrap; line-height: 1.4; border: 1px solid #333;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .log-header { color:#fff; font-weight:bold; border-bottom:1px solid #444; margin-bottom:6px; padding-bottom:2px; font-size:12px; }
    .log-line { border-bottom:1px solid #222; padding:2px 0; color:#aaa; display: flex; justify-content: space-between;}
    .log-highlight { color:#fff; font-weight:bold; }
    .log-section { margin-top:10px; border-top:1px dashed #444; padding-top:5px; color:#f59e0b; font-weight:bold;}

    /* CONTROLS */
    #controls {
        position: absolute; bottom: 30px; z-index: 50;
        display: flex; gap: 10px; padding: 10px;
        background: var(--surface); backdrop-filter: blur(16px);
        border-radius: 28px; border: var(--glass-border);
        box-shadow: 0 20px 50px rgba(0,0,0,0.12);
    }
    .control-btn {
        border: none; padding: 14px 24px; border-radius: 20px;
        font-weight: 700; font-size: 0.9rem; cursor: pointer;
        display: flex; align-items: center; gap: 8px; transition: transform 0.1s;
    }
    .btn-ghost { background: transparent; color: #64748b; }
    .btn-primary { background: var(--text-main); color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
    .btn-magic { background: linear-gradient(135deg, #6366f1, #a855f7); color: white; box-shadow: 0 8px 20px -5px rgba(168, 85, 247, 0.4); }
    .control-btn:active { transform: scale(0.95); }

    /* CANVAS */
    #canvas-container {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        border-radius: 40px; background: #ffffff;
        box-shadow: 0 30px 70px -20px rgba(0, 0, 0, 0.15);
        touch-action: none; overflow: hidden; border: 6px solid #ffffff;
    }
    canvas { display: block; touch-action: none; }

    /* SETTINGS MODAL */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); z-index: 190; display: none;
    }
    #settings-modal {
        position: fixed; bottom: -100%; left: 50%; transform: translateX(-50%);
        width: 92%; max-width: 480px;
        background: #ffffff;
        border-top-left-radius: 32px; border-top-right-radius: 32px;
        box-shadow: 0 -20px 60px rgba(0,0,0,0.15); z-index: 200;
        padding: 30px; box-sizing: border-box;
        transition: bottom 0.35s cubic-bezier(0.16, 1, 0.3, 1);
        display: flex; flex-direction: column; gap: 20px;
        max-height: 85vh; overflow-y: auto;
    }
    #settings-modal.active { bottom: 15px; border-radius: 32px; }

    .setting-card {
        background: #f8fafc; border-radius: 20px; padding: 18px;
        border: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 14px;
    }
    .card-label { font-size: 0.75rem; color: #94a3b8; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
    .row { display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: #334155; font-size: 0.95rem; }

    /* Controls */
    .switch { position: relative; width: 48px; height: 28px; flex-shrink: 0; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; border-radius: 34px; transition: .2s; }
    .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input:checked + .slider { background-color: var(--primary); }
    input:checked + .slider:before { transform: translateX(20px); }

    input[type=number] { background: #fff; border: 1px solid #cbd5e1; border-radius: 10px; padding: 8px; width: 60px; text-align: center; font-weight: 700; color: var(--text-main); font-family: inherit; }
    input[type=range] { width: 100%; height: 6px; background: #e2e8f0; border-radius: 10px; accent-color: var(--primary); }

    /* Theme Grid */
    .theme-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .theme-btn {
        height: 60px; border-radius: 16px; cursor: pointer;
        border: 2px solid transparent; background: #fff;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        font-size: 0.7rem; font-weight: 700; color: #64748b; gap: 6px;
        transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .theme-btn.active { border-color: var(--primary); background: #eff6ff; color: var(--primary); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(37, 99, 235, 0.15); }
    .theme-dot { width: 10px; height: 10px; border-radius: 50%; }

    .btn-close { background: #f1f5f9; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; color: #64748b; display: flex; align-items: center; justify-content: center;}

    /* TOAST */
    .toast {
        position: fixed; top: 90px; left: 50%; transform: translateX(-50%) translateY(-20px);
        background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(4px); color: white; padding: 12px 24px;
        border-radius: 30px; font-size: 0.85rem; font-weight: 600; pointer-events: none;
        opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 300;
        box-shadow: 0 10px 20px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 8px;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

    <div id="loading-screen">
        <div class="spinner"></div>
        <div class="loading-brand">GeoLab v2.3</div>
        <script>setTimeout(()=>{var s=document.getElementById('loading-screen');if(s){s.style.opacity='0';setTimeout(()=>{if(s)s.style.display='none';},500);}},1200);</script>
    </div>

    <div id="debug-console">Initializing...</div>

    <div id="settings-overlay" class="modal-overlay" onclick="toggleSettings()"></div>

    <div id="settings-modal">
        <div class="row">
            <span style="font-size:1.4rem; font-weight:800; letter-spacing:-0.5px;">Settings</span>
            <button class="btn-close" onclick="toggleSettings()">√ó</button>
        </div>

        <div class="setting-card">
            <div class="card-label" style="color:#f59e0b;">Developer</div>
            <div class="row">
                <span>Show Hitboxes</span>
                <label class="switch"><input type="checkbox" id="opt-show-hitboxes" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label" style="color:#ef4444;">Physics Engine</div>
            <div class="row">
                <span>Reflex Angles (>180¬∞)</span>
                <label class="switch"><input type="checkbox" id="opt-reflex" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label">Controls</div>
            <div class="row">
                <span>Snap Rotation</span>
                <label class="switch"><input type="checkbox" id="opt-snap-active" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Step Angle</span>
                <input type="number" id="opt-snap-val" value="5" min="1" max="360" onchange="updateSettings()">
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label">Workspace</div>
            <div class="row">
                <span>Center Hub</span>
                <label class="switch"><input type="checkbox" id="opt-show-center" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Angle Labels</span>
                <label class="switch"><input type="checkbox" id="opt-always-show" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Background Grid</span>
                <label class="switch"><input type="checkbox" id="opt-show-grid" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div style="height:1px; background:#e2e8f0; margin:5px 0;"></div>
            <div class="row" style="font-size:0.85rem;">
                <span>Text Size: <strong id="lbl-text-scale" style="color:var(--primary)">1.0x</strong></span>
            </div>
            <input type="range" id="opt-text-scale" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSettings()">
            <div class="row" style="font-size:0.85rem; margin-top:5px;">
                <span>Protractors: <strong id="lbl-count" style="color:var(--primary)">8</strong></span>
            </div>
            <input type="range" id="opt-count" min="4" max="10" step="1" oninput="updateSettings()">
        </div>

        <div class="setting-card">
            <div class="card-label">Color Scheme</div>
            <div class="theme-grid">
                <div class="theme-btn" id="theme-default" onclick="selectTheme('default')"><div class="theme-dot" style="background:#0f172a"></div>Apple</div>
                <div class="theme-btn" id="theme-blueprint" onclick="selectTheme('blueprint')"><div class="theme-dot" style="background:#1e3a8a"></div>Print</div>
                <div class="theme-btn" id="theme-midnight" onclick="selectTheme('midnight')"><div class="theme-dot" style="background:#000000"></div>OLED</div>
                <div class="theme-btn" id="theme-candy" onclick="selectTheme('candy')"><div class="theme-dot" style="background:#ec4899"></div>Candy</div>
                <div class="theme-btn" id="theme-royal" onclick="selectTheme('royal')"><div class="theme-dot" style="background:#4338ca"></div>Royal</div>
                <div class="theme-btn" id="theme-forest" onclick="selectTheme('forest')"><div class="theme-dot" style="background:#059669"></div>Sage</div>
                <div class="theme-btn" id="theme-paper" onclick="selectTheme('paper')"><div class="theme-dot" style="background:#a8a29e"></div>Paper</div>
                <div class="theme-btn" id="theme-matrix" onclick="selectTheme('matrix')"><div class="theme-dot" style="background:#22c55e"></div>Matrix</div>
            </div>
        </div>
        
        <button style="background:#fee2e2; color:#b91c1c; width:100%; padding:14px; border:none; border-radius:16px; font-weight:700; font-size:0.9rem;" onclick="resetSettings()">Reset to Factory</button>
    </div>

    <header>
        <div class="brand-container">
            <div class="brand-title">GeoLab <span class="dev-badge">v2.3</span></div>
            <div class="brand-status" id="status-text"><div class="dot"></div> Active</div>
        </div>
        <div class="header-actions">
            <button class="btn-icon-only" onclick="toggleDebug()" title="Debug">üêû</button>
            <button class="btn-icon-only" onclick="toggleSettings()">‚öôÔ∏è</button>
        </div>
    </header>
    
    <div id="canvas-container"><canvas id="geoCanvas"></canvas></div>
    
    <div id="controls">
        <button class="control-btn btn-ghost" onclick="clearStrings()">Clear</button>
        <button class="control-btn btn-primary" onclick="resetBoard()">Reset</button>
        <button class="control-btn btn-magic" onclick="autoAlign()">‚ú® Align</button>
    </div>

    <div class="toast" id="toast">Action Saved</div>

<script>
    // --- HELPER ---
    function getCheck(id) { const el = document.getElementById(id); return el ? el.checked : false; }
    function getVal(id) { const el = document.getElementById(id); return el ? el.value : ""; }
    function showToast(msg) { 
        const t = document.getElementById('toast'); 
        t.innerText = msg; t.classList.add('show'); 
        setTimeout(() => t.classList.remove('show'), 2000); 
    }

    // DRAW HELPER FOR OLDER BROWSERS
    function drawRoundRect(ctx, x, y, w, h, r) {
        if (ctx.roundRect) {
            ctx.roundRect(x, y, w, h, r);
        } else {
            if (w < 2 * r) r = w / 2;
            if (h < 2 * r) r = h / 2;
            ctx.moveTo(x + r, y);
            ctx.arcTo(x + w, y, x + w, y + h, r);
            ctx.arcTo(x + w, y + h, x, y + h, r);
            ctx.arcTo(x, y + h, x, y, r);
            ctx.arcTo(x, y, x + w, y, r);
        }
    }

    const canvas = document.getElementById('geoCanvas');
    const ctx = canvas.getContext('2d');

    // --- DEBUG ENGINE ---
    let debugMode = false;
    let lastTime = 0, frameCount = 0, fps = 0, ptrX=0, ptrY=0, renderTime=0;
    let logBuffer = [];
    let inspectedObj = null;

    function toggleDebug() {
        debugMode = !debugMode;
        document.getElementById('debug-console').style.display = debugMode ? 'block' : 'none';
        if(debugMode) draw();
    }

    function log(msg) {
        if(!debugMode) return;
        const time = new Date().toLocaleTimeString('en-US', {hour12: false});
        logBuffer.push(`[${time}] ${msg}`);
        if(logBuffer.length > 4) logBuffer.shift();
    }

    function updateDebugLog() {
        if(!debugMode) return;
        const now = performance.now(); frameCount++;
        if(now - lastTime >= 1000) { fps = frameCount; frameCount=0; lastTime=now; }
        
        let inspectHtml = '<span style="color:#666">Click obj to inspect</span>';
        if(inspectedObj) {
            let deg = (inspectedObj.angle * (180/Math.PI)).toFixed(1);
            inspectHtml = `
            <div class="log-line">ID: <span class="log-highlight">${inspectedObj.id}</span></div>
            <div class="log-line">Angle: <span class="log-highlight">${deg}¬∞</span></div>
            <div class="log-line">Rad: <span class="log-highlight">${inspectedObj.angle.toFixed(3)}</span></div>
            `;
        }

        let html = `
<div class="log-header">SYSTEM MONITOR</div>
<div class="log-line">FPS: <span class="log-highlight">${fps}</span></div>
<div class="log-line">Render: <span class="log-highlight">${renderTime.toFixed(2)}ms</span></div>
<div class="log-line">Pointer: <span class="log-highlight">${Math.round(ptrX)},${Math.round(ptrY)}</span></div>
<div class="log-section">INSPECTOR</div>
${inspectHtml}
<div class="log-section">EVENT LOG</div>
`;
        logBuffer.forEach(l => { html += `<div style="color:#0f0; font-size:9px;">${l}</div>`; });
        document.getElementById('debug-console').innerHTML = html;
    }

    const THEMES = {
        'default': { bg: '#ffffff', line: '#3b82f6', tick: '#64748b', text: '#334155', bodyBg: '#f8fafc', pin: '#fbbf24', labelBg: '#ffffff', labelTxt: '#2563eb' },
        'blueprint': { bg: '#1e3a8a', line: '#ffffff', tick: '#ffffff', text: '#e0f2fe', bodyBg: '#172554', pin: '#60a5fa', labelBg: '#172554', labelTxt: '#ffffff' },
        'midnight': { bg: '#000000', line: '#38bdf8', tick: '#94a3b8', text: '#e2e8f0', bodyBg: '#0f172a', pin: '#0ea5e9', labelBg: '#1e293b', labelTxt: '#38bdf8' },
        'paper': { bg: '#fffbf0', line: '#57534e', tick: '#78716c', text: '#44403c', bodyBg: '#f5f5f4', pin: '#d97706', labelBg: '#f5f5f4', labelTxt: '#44403c' },
        'matrix': { bg: '#022c22', line: '#22c55e', tick: '#4ade80', text: '#4ade80', bodyBg: '#000000', pin: '#ffffff', labelBg: '#000000', labelTxt: '#22c55e' },
        'candy': { bg: '#fff1f2', line: '#db2777', tick: '#be185d', text: '#9d174d', bodyBg: '#fdf2f8', pin: '#f472b6', labelBg: '#ffffff', labelTxt: '#be185d' },
        'royal': { bg: '#312e81', line: '#fbbf24', tick: '#e0e7ff', text: '#fef3c7', bodyBg: '#1e1b4b', pin: '#f59e0b', labelBg: '#1e1b4b', labelTxt: '#fbbf24' },
        'forest': { bg: '#ecfdf5', line: '#059669', tick: '#047857', text: '#064e3b', bodyBg: '#d1fae5', pin: '#10b981', labelBg: '#ffffff', labelTxt: '#059669' }
    };

    const DEFAULTS = { 
        alwaysShowAngles: true, showGrid: true, snapRotation: false, snapIncrement: 5, 
        strictPhysics: true, protractorCount: 8, currentTheme: 'default', textScale: 1.0, showHitboxes: false, showCenter: true
    };
    
    let appSettings = {...DEFAULTS};
    try {
        const stored = JSON.parse(localStorage.getItem('geoSettings'));
        if (stored) {
            appSettings = {...DEFAULTS,ss="row">
                <span>Show Hitboxes</span>
                <label class="switch"><input type="checkbox" id="opt-show-hitboxes" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label" style="color:#ef4444;">Physics Engine</div>
            <div class="row">
                <span>Reflex Angles (>180¬∞)</span>
                <label class="switch"><input type="checkbox" id="opt-reflex" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label">Controls</div>
            <div class="row">
                <span>Snap Rotation</span>
                <label class="switch"><input type="checkbox" id="opt-snap-active" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Step Angle</span>
                <input type="number" id="opt-snap-val" value="5" min="1" max="360" onchange="updateSettings()">
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label">Workspace</div>
            <div class="row">
                <span>Center Hub</span>
                <label class="switch"><input type="checkbox" id="opt-show-center" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Angle Labels</span>
                <label class="switch"><input type="checkbox" id="opt-always-show" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Background Grid</span>
                <label class="switch"><input type="checkbox" id="opt-show-grid" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div style="height:1px; background:#e2e8f0; margin:5px 0;"></div>
            <div class="row" style="font-size:0.85rem;">
                <span>Text Size: <strong id="lbl-text-scale" style="color:var(--primary)">1.0x</strong></span>
            </div>
            <input type="range" id="opt-text-scale" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSettings()">
            <div class="row" style="font-size:0.85rem; margin-top:5px;">
                <span>Protractors: <strong id="lbl-count" style="color:var(--primary)">8</strong></span>
            </div>
            <input type="range" id="opt-count" min="4" max="10" step="1" oninput="updateSettings()">
        </div>

        <div class="setting-card">
            <div class="card-label">Color Scheme</div>
            <div class="theme-grid">
                <div class="theme-btn" id="theme-default" onclick="selectTheme('default')"><div class="theme-dot" style="background:#0f172a"></div>Apple</div>
                <div class="theme-btn" id="theme-blueprint" onclick="selectTheme('blueprint')"><div class="theme-dot" style="background:#1e3a8a"></div>Print</div>
                <div class="theme-btn" id="theme-midnight" onclick="selectTheme('midnight')"><div class="theme-dot" style="background:#000000"></div>OLED</div>
                <div class="theme-btn" id="theme-candy" onclick="selectTheme('candy')"><div class="theme-dot" style="background:#ec4899"></div>Candy</div>
                <div class="theme-btn" id="theme-royal" onclick="selectTheme('royal')"><div class="theme-dot" style="background:#4338ca"></div>Royal</div>
                <div class="theme-btn" id="theme-forest" onclick="selectTheme('forest')"><div class="theme-dot" style="background:#059669"></div>Sage</div>
                <div class="theme-btn" id="theme-paper" onclick="selectTheme('paper')"><div class="theme-dot" style="background:#a8a29e"></div>Paper</div>
                <div class="theme-btn" id="theme-matrix" onclick="selectTheme('matrix')"><div class="theme-dot" style="background:#22c55e"></div>Matrix</div>
            </div>
        </div>
        
        <button style="background:#fee2e2; color:#b91c1c; width:100%; padding:14px; border:none; border-radius:16px; font-weight:700; font-size:0.9rem;" onclick="resetSettings()">Reset to Factory</button>
    </div>

    <header>
        <div class="brand-container">
            <div class="brand-title">GeoLab <span class="dev-badge">DEV</span></div>
            <div class="brand-status" id="status-text"><div class="dot"></div> Active</div>
        </div>
        <div class="header-actions">
            <button class="btn-icon-only" onclick="toggleDebug()" title="Debug">üêû</button>
            <button class="btn-icon-only" onclick="toggleSettings()">‚öôÔ∏è</button>
        </div>
    </header>
    
    <div id="canvas-container"><canvas id="geoCanvas"></canvas></div>
    
    <div id="controls">
        <button class="control-btn btn-ghost" onclick="clearStrings()">Clear</button>
        <button class="control-btn btn-primary" onclick="resetBoard()">Reset</button>
        <button class="control-btn btn-magic" onclick="autoAlign()">‚ú® Align</button>
    </div>

    <div class="toast" id="toast">Action Saved</div>

<script>
    // --- HELPER ---
    function getCheck(id) { const el = document.getElementById(id); return el ? el.checked : false; }
    function getVal(id) { const el = document.getElementById(id); return el ? el.value : ""; }
    function showToast(msg) { 
        const t = document.getElementById('toast'); 
        t.innerText = msg; t.classList.add('show'); 
        setTimeout(() => t.classList.remove('show'), 2000); 
    }

    const canvas = document.getElementById('geoCanvas');
    const ctx = canvas.getContext('2d');

    // --- DEBUG ENGINE ---
    let debugMode = false;
    let lastTime = 0, frameCount = 0, fps = 0, ptrX=0, ptrY=0, renderTime=0;
    let logBuffer = [];
    let inspectedObj = null;

    function toggleDebug() {
        debugMode = !debugMode;
        document.getElementById('debug-console').style.display = debugMode ? 'block' : 'none';
        if(debugMode) draw();
    }

    function log(msg) {
        if(!debugMode) return;
        const time = new Date().toLocaleTimeString('en-US', {hour12: false});
        logBuffer.push(`[${time}] ${msg}`);
        if(logBuffer.length > 4) logBuffer.shift();
    }

    function updateDebugLog() {
        if(!debugMode) return;
        const now = performance.now(); frameCount++;
        if(now - lastTime >= 1000) { fps = frameCount; frameCount=0; lastTime=now; }
        
        let inspectHtml = '<span style="color:#666">Click obj to inspect</span>';
        if(inspectedObj) {
            let deg = (inspectedObj.angle * (180/Math.PI)).toFixed(1);
            inspectHtml = `
            <div class="log-line">ID: <span class="log-highlight">${inspectedObj.id}</span></div>
            <div class="log-line">Angle: <span class="log-highlight">${deg}¬∞</span></div>
            <div class="log-line">Rad: <span class="log-highlight">${inspectedObj.angle.toFixed(3)}</span></div>
            `;
        }

        let html = `
<div class="log-header">SYSTEM MONITOR</div>
<div class="log-line">FPS: <span class="log-highlight">${fps}</span></div>
<div class="log-line">Render: <span class="log-highlight">${renderTime.toFixed(2)}ms</span></div>
<div class="log-line">Pointer: <span class="log-highlight">${Math.round(ptrX)},${Math.round(ptrY)}</span></div>
<div class="log-section">INSPECTOR</div>
${inspectHtml}
<div class="log-section">EVENT LOG</div>
`;
        logBuffer.forEach(l => { html += `<div style="color:#0f0; font-size:9px;">${l}</div>`; });
        document.getElementById('debug-console').innerHTML = html;
    }

    const THEMES = {
        'default': { bg: '#ffffff', line: '#3b82f6', tick: '#64748b', text: '#334155', bodyBg: '#f8fafc', pin: '#fbbf24', labelBg: '#ffffff', labelTxt: '#2563eb' },
        'blueprint': { bg: '#1e3a8a', line: '#ffffff', tick: '#ffffff', text: '#e0f2fe', bodyBg: '#172554', pin: '#60a5fa', labelBg: '#172554', labelTxt: '#ffffff' },
        'midnight': { bg: '#000000', line: '#38bdf8', tick: '#94a3b8', text: '#e2e8f0', bodyBg: '#0f172a', pin: '#0ea5e9', labelBg: '#1e293b', labelTxt: '#38bdf8' },
        'paper': { bg: '#fffbf0', line: '#57534e', tick: '#78716c', text: '#44403c', bodyBg: '#f5f5f4', pin: '#d97706', labelBg: '#f5f5f4', labelTxt: '#44403c' },
        'matrix': { bg: '#022c22', line: '#22c55e', tick: '#4ade80', text: '#4ade80', bodyBg: '#000000', pin: '#ffffff', labelBg: '#000000', labelTxt: '#22c55e' },
        'candy': { bg: '#fff1f2', line: '#db2777', tick: '#be185d', text: '#9d174d', bodyBg: '#fdf2f8', pin: '#f472b6', labelBg: '#ffffff', labelTxt: '#be185d' },
        'royal': { bg: '#312e81', line: '#fbbf24', tick: '#e0e7ff', text: '#fef3c7', bodyBg: '#1e1b4b', pin: '#f59e0b', labelBg: '#1e1b4b', labelTxt: '#fbbf24' },
        'forest': { bg: '#ecfdf5', line: '#059669', tick: '#047857', text: '#064e3b', bodyBg: '#d1fae5', pin: '#10b981', labelBg: '#ffffff', labelTxt: '#059669' }
    };

    const DEFAULTS = { 
        alwaysShowAngles: true, showGrid: true, snapRotation: false, snapIncrement: 5, 
        strictPhysics: true, protractorCount: 8, currentTheme: 'default', textScale: 1.0, showHitboxes: false, showCenter: true
    };
    
    let appSettings = {...DEFAULTS};
    try {
        const stored = JSON.parse(localStorage.getItem('geoSettings'));
        if (stored) {
            appSettings = {...DEFAULTS, ...stored};
            if (!THEMES[appSettings.currentTheme]) appSettings.currentTheme = 'default';
        }
    } catch(e) { appSettings = {...DEFAULTS}; }

    let NUM_PROTRACTORS = appSettings.protractorCount;
    const CENTER_ID = 999; 
    let boardRadius, protractorRadius, centerProtractorRadius;
    let width, height, centerX, centerY;
    let protractors = [], strings = [];
    let draggingProtractor = null, dragOffsetAngle = 0, activeStringStartID = null, hoveredPinID = null;

    class="row">
                <span>Show Hitboxes</span>
                <label class="switch"><input type="checkbox" id="opt-show-hitboxes" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label" style="color:#ef4444;">Physics Engine</div>
            <div class="row">
                <span>Reflex Angles (>180¬∞)</span>
                <label class="switch"><input type="checkbox" id="opt-reflex" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label">Controls</div>
            <div class="row">
                <span>Snap Rotation</span>
                <label class="switch"><input type="checkbox" id="opt-snap-active" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Step Angle</span>
                <input type="number" id="opt-snap-val" value="5" min="1" max="360" onchange="updateSettings()">
            </div>
        </div>

        <div class="setting-card">
            <div class="card-label">Workspace</div>
            <div class="row">
                <span>Center Hub</span>
                <label class="switch"><input type="checkbox" id="opt-show-center" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Angle Labels</span>
                <label class="switch"><input type="checkbox" id="opt-always-show" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div class="row">
                <span>Background Grid</span>
                <label class="switch"><input type="checkbox" id="opt-show-grid" onchange="updateSettings()"><span class="slider"></span></label>
            </div>
            <div style="height:1px; background:#e2e8f0; margin:5px 0;"></div>
            <div class="row" style="font-size:0.85rem;">
                <span>Text Size: <strong id="lbl-text-scale" style="color:var(--primary)">1.0x</strong></span>
            </div>
            <input type="range" id="opt-text-scale" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSettings()">
            <div class="row" style="font-size:0.85rem; margin-top:5px;">
                <span>Protractors: <strong id="lbl-count" style="color:var(--primary)">8</strong></span>
            </div>
            <input type="range" id="opt-count" min="4" max="10" step="1" oninput="updateSettings()">
        </div>

        <div class="setting-card">
            <div class="card-label">Color Scheme</div>
            <div class="theme-grid">
                <div class="theme-btn" id="theme-default" onclick="selectTheme('default')"><div class="theme-dot" style="background:#0f172a"></div>Apple</div>
                <div class="theme-btn" id="theme-blueprint" onclick="selectTheme('blueprint')"><div class="theme-dot" style="background:#1e3a8a"></div>Print</div>
                <div class="theme-btn" id="theme-midnight" onclick="selectTheme('midnight')"><div class="theme-dot" style="background:#000000"></div>OLED</div>
                <div class="theme-btn" id="theme-candy" onclick="selectTheme('candy')"><div class="theme-dot" style="background:#ec4899"></div>Candy</div>
                <div class="theme-btn" id="theme-royal" onclick="selectTheme('royal')"><div class="theme-dot" style="background:#4338ca"></div>Royal</div>
                <div class="theme-btn" id="theme-forest" onclick="selectTheme('forest')"><div class="theme-dot" style="background:#059669"></div>Sage</div>
                <div class="theme-btn" id="theme-paper" onclick="selectTheme('paper')"><div class="theme-dot" style="background:#a8a29e"></div>Paper</div>
                <div class="theme-btn" id="theme-matrix" onclick="selectTheme('matrix')"><div class="theme-dot" style="background:#22c55e"></div>Matrix</div>
            </div>
        </div>
        
        <button style="background:#fee2e2; color:#b91c1c; width:100%; padding:14px; border:none; border-radius:16px; font-weight:700; font-size:0.9rem;" onclick="resetSettings()">Reset to Factory</button>
    </div>

    <header>
        <div class="brand-container">
            <div class="brand-title">GeoLab <span class="dev-badge">DEV</span></div>
            <div class="brand-status" id="status-text"><div class="dot"></div> Active</div>
        </div>
        <div class="header-actions">
            <button class="btn-icon-only" onclick="toggleDebug()" title="Debug">üêû</button>
            <button class="btn-icon-only" onclick="toggleSettings()">‚öôÔ∏è</button>
        </div>
    </header>
    
    <div id="canvas-container"><canvas id="geoCanvas"></canvas></div>
    
    <div id="controls">
        <button class="control-btn btn-ghost" onclick="clearStrings()">Clear</button>
        <button class="control-btn btn-primary" onclick="resetBoard()">Reset</button>
        <button class="control-btn btn-magic" onclick="autoAlign()">‚ú® Align</button>
    </div>

    <div class="toast" id="toast">Action Saved</div>

<script>
    // --- HELPER ---
    function getCheck(id) { const el = document.getElementById(id); return el ? el.checked : false; }
    function getVal(id) { const el = document.getElementById(id); return el ? el.value : ""; }
    function showToast(msg) { 
        const t = document.getElementById('toast'); 
        t.innerText = msg; t.classList.add('show'); 
        setTimeout(() => t.classList.remove('show'), 2000); 
    }

    const canvas = document.getElementById('geoCanvas');
    const ctx = canvas.getContext('2d');

    // --- DEBUG ENGINE ---
    let debugMode = false;
    let lastTime = 0, frameCount = 0, fps = 0, ptrX=0, ptrY=0, renderTime=0;
    let logBuffer = [];
    let inspectedObj = null;

    function toggleDebug() {
        debugMode = !debugMode;
        document.getElementById('debug-console').style.display = debugMode ? 'block' : 'none';
        if(debugMode) draw();
    }

    function log(msg) {
        if(!debugMode) return;
        const time = new Date().toLocaleTimeString('en-US', {hour12: false});
        logBuffer.push(`[${time}] ${msg}`);
        if(logBuffer.length > 4) logBuffer.shift();
    }

    function updateDebugLog() {
        if(!debugMode) return;
        const now = performance.now(); frameCount++;
        if(now - lastTime >= 1000) { fps = frameCount; frameCount=0; lastTime=now; }
        
        let inspectHtml = '<span style="color:#666">Click obj to inspect</span>';
        if(inspectedObj) {
            let deg = (inspectedObj.angle * (180/Math.PI)).toFixed(1);
            inspectHtml = `
            <div class="log-line">ID: <span class="log-highlight">${inspectedObj.id}</span></div>
            <div class="log-line">Angle: <span class="log-highlight">${deg}¬∞</span></div>
            <div class="log-line">Rad: <span class="log-highlight">${inspectedObj.angle.toFixed(3)}</span></div>
            `;
        }

        let html = `
<div class="log-header">SYSTEM MONITOR</div>
<div class="log-line">FPS: <span class="log-highlight">${fps}</span></div>
<div class="log-line">Render: <span class="log-highlight">${renderTime.toFixed(2)}ms</span></div>
<div class="log-line">Pointer: <span class="log-highlight">${Math.round(ptrX)},${Math.round(ptrY)}</span></div>
<div class="log-section">INSPECTOR</div>
${inspectHtml}
<div class="log-section">EVENT LOG</div>
`;
        logBuffer.forEach(l => { html += `<div style="color:#0f0; font-size:9px;">${l}</div>`; });
        document.getElementById('debug-console').innerHTML = html;
    }

    const THEMES = {
        'default': { bg: '#ffffff', line: '#3b82f6', tick: '#64748b', text: '#334155', bodyBg: '#f8fafc', pin: '#fbbf24', labelBg: '#ffffff', labelTxt: '#2563eb' },
        'blueprint': { bg: '#1e3a8a', line: '#ffffff', tick: '#ffffff', text: '#e0f2fe', bodyBg: '#172554', pin: '#60a5fa', labelBg: '#172554', labelTxt: '#ffffff' },
        'midnight': { bg: '#000000', line: '#38bdf8', tick: '#94a3b8', text: '#e2e8f0', bodyBg: '#0f172a', pin: '#0ea5e9', labelBg: '#1e293b', labelTxt: '#38bdf8' },
        'paper': { bg: '#fffbf0', line: '#57534e', tick: '#78716c', text: '#44403c', bodyBg: '#f5f5f4', pin: '#d97706', labelBg: '#f5f5f4', labelTxt: '#44403c' },
        'matrix': { bg: '#022c22', line: '#22c55e', tick: '#4ade80', text: '#4ade80', bodyBg: '#000000', pin: '#ffffff', labelBg: '#000000', labelTxt: '#22c55e' },
        'candy': { bg: '#fff1f2', line: '#db2777', tick: '#be185d', text: '#9d174d', bodyBg: '#fdf2f8', pin: '#f472b6', labelBg: '#ffffff', labelTxt: '#be185d' },
        'royal': { bg: '#312e81', line: '#fbbf24', tick: '#e0e7ff', text: '#fef3c7', bodyBg: '#1e1b4b', pin: '#f59e0b', labelBg: '#1e1b4b', labelTxt: '#fbbf24' },
        'forest': { bg: '#ecfdf5', line: '#059669', tick: '#047857', text: '#064e3b', bodyBg: '#d1fae5', pin: '#10b981', labelBg: '#ffffff', labelTxt: '#059669' }
    };

    const DEFAULTS = { 
        alwaysShowAngles: true, showGrid: true, snapRotation: false, snapIncrement: 5, 
        strictPhysics: true, protractorCount: 8, currentTheme: 'default', textScale: 1.0, showHitboxes: false, showCenter: true
    };
    
    let appSettings = {...DEFAULTS};
    try {
        const stored = JSON.parse(localStorage.getItem('geoSettings'));
        if (stored) {
            appSettings = {...DEFAULTS, ...stored};
            if (!THEMES[appSettings.currentTheme]) appSettings.currentTheme = 'default';
        }
    } catch(e) { appSettings = {...DEFAULTS}; }

    let NUM_PROTRACTORS = appSettings.protractorCount;
    const CENTER_ID = 999; 
    let boardRadius, protractorRadius, centerProtractorRadius;
    let width, height, centerX, centerY;
    let protractors = [], strings = [];
    let draggingProtractor = null, dragOffsetAngle = 0, activeStringStartID = null, hoveredPinID = null;

 nce middle school. We always used to play Roblox together.
            </div>
          </div>

          <div class="friend-row bottom">
            <div class="friend-visual">
              <img src="imagefolder/saif.jpg" alt="Saif" class="avatar">
              <div class="friend-name">Saif</div>
            </div>
            <div class="friend-desc">
              shorter than me and we also used to play duo in mobile legends and I like to tease him with someone he likes at middle school
            </div>
          </div>

        </div>
      </div>
    </section>

  </div>

  <script>
    // 1. ANIMATION TRIGGER
    const slides = document.querySelectorAll('.slide');
    const container = document.querySelector('.scroll-container');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
        } else {
          entry.target.classList.remove('active');
        }
      });
    }, { threshold: 0.5 });
    slides.forEach(slide => observer.observe(slide));


    // 2. KEYBOARD NAVIGATION
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault(); 
        
        const viewportHeight = window.innerHeight;
        const currentScroll = container.scrollTop;
        const currentIndex = Math.round(currentScroll / viewportHeight);
        
        let nextIndex = currentIndex;

        if (e.key === 'ArrowDown') {
          nextIndex = Math.min(currentIndex + 1, slides.length - 1);
        } else if (e.key === 'ArrowUp') {
          nextIndex = Math.max(currentIndex - 1, 0);
        }

        slides[nextIndex].scrollIntoView({ behavior: 'smooth' });
      }
    });
  </script>

</body>
</html>




